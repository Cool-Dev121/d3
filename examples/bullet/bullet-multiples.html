<!DOCTYPE html>
<html>
  <head>
    <title>Bullet Chart (Multiples)</title>
    <script type="text/javascript" src="../../d3.js"></script>
    <script type="text/javascript" src="../../d3.chart.js"></script>
    <script type="text/javascript" src="bullets.js"></script>
    <link type="text/css" rel="stylesheet" href="bullet.css"/>
  </head>
  <body>
    <script type="text/javascript">

var bullet = function(chart) {
  chart.each(function(orient) {
    var bulletChart = d3.chart.bullet()
      .orient(orient).duration(1000);
    // Is there a simpler way to construct a group from the current node?
    chart.filter(function(d) { return d === orient; })
        .selectAll('g.bullet').call(bulletChart);
  });
};

var vis = d3.select("body").selectAll('svg')
    .data(['left', 'right', 'top', 'bottom'])
  .enter().append("svg:svg")
    .attr("width", 520)
    .attr("height", 300)
  .append("svg:g")
    .attr("transform", "translate(10,0)");

vis.selectAll("g.bullet")
    .data(bullets)
  .enter().append("svg:g")
    .attr("class", "bullet")
    .attr("transform", function(d, i) { return "translate(0," + (i * 60) + ")"; })

vis.call(bullet);

function randomize() {
  for (var i = 0, ii = bullets.length; i < ii; i++) {
    var b = bullets[i];
    b.ranges = b.ranges.map(function(d) { return Math.random() * 1000; });
    b.markers = b.markers.map(function(d) { return Math.random() * 1000; });
    b.measures = b.measures.map(function(d) { return Math.random() * 1000; });
  }
  vis.call(bullet);
}

    </script>
    <input type="button" value="Randomize!" onclick="randomize()">
  </body>
</html>
