<!DOCTYPE html>
<html>
  <head>
    <title>Bullet Chart (Multiples)</title>
    <script type="text/javascript" src="../../d3.js"></script>
    <script type="text/javascript" src="../../d3.chart.js"></script>
    <script type="text/javascript" src="bullets.js"></script>
    <link type="text/css" rel="stylesheet" href="bullet.css"/>
  </head>
  <body>
    <input type="button" value="Randomize!" onclick="randomize()"><br>
    <script type="text/javascript">

var w = 500,
    h = 50,
    m = [5, 40, 20, 120]; // top right bottom left

var bullet = d3.chart.bullet()
    .width(w - m[1] - m[3])
    .height(h - m[0] - m[2])
    .duration(5000);

var vis = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h * bullets.length);

var g = vis.selectAll("g.bullet")
    .data(bullets)
  .enter().append("svg:g")
    .attr("class", "bullet")
    .attr("transform", function(d, i) {
      return "translate(" + m[3] + "," + (i * h + m[0]) + ")";
    });

g.append("svg:text")
    .attr("class", "title")
    .attr("text-anchor", "end")
    .attr("dx", "-6")
    .attr("y", bullet.height() / 2)
    .text(function(d) { return d.title; });

g.append("svg:text")
    .attr("class", "subtitle")
    .attr("text-anchor", "end")
    .attr("dx", "-6")
    .attr("dy", "1em")
    .attr("y", bullet.height() / 2)
    .text(function(d) { return d.subtitle; });

vis.each(refresh);

function refresh() {
  d3.select(this).selectAll("g.bullet").call(bullet);
}

function randomize() {
  for (var i = -1, n = bullets.length, b; ++i < n;) {
    b = bullets[i];
    b.ranges = b.ranges.map(random);
    b.markers = b.markers.map(random);
    b.measures = b.measures.map(random);
  }
  vis.each(refresh);
}

function random() {
  return Math.random() * 1000;
}

    </script>
  </body>
</html>
