<!DOCTYPE html>
<html>
  <head>
    <title>Bullet Chart (Randomize)</title>
    <script type="text/javascript" src="../../d3.js"></script>
    <script type="text/javascript" src="../../d3.chart.js"></script>
    <link type="text/css" rel="stylesheet" href="bullet.css"/>
  </head>
  <body>
    <input type="button" value="Randomize!" onclick="randomize()"><br>
    <script type="text/javascript">

var w = 380,
    h = 25,
    m = [5, 40, 20, 120], // top right bottom left
    n = 5;

var chart = d3.chart.bullet()
    .width(w)
    .height(h)
    .duration(1000);

var vis = d3.select("body").append("svg:svg")
    .attr("width", w + m[1] + m[3])
    .attr("height", (h + m[0] + m[2]) * n);

var g = vis.selectAll("g.bullet")
    .data(randomBullets)
  .enter().append("svg:g")
    .attr("class", "bullet")
    .attr("transform", function(d, i) {
      return "translate(" + m[3] + "," + (i * (h + m[0] + m[2]) + m[0]) + ")";
    });

g.append("svg:text")
    .attr("class", "title")
    .attr("text-anchor", "end")
    .attr("dx", "-6")
    .attr("y", h / 2)
    .text(function(d) { return d.title; });

g.append("svg:text")
    .attr("class", "subtitle")
    .attr("text-anchor", "end")
    .attr("dx", "-6")
    .attr("dy", "1em")
    .attr("y", h / 2)
    .text(function(d) { return d.subtitle; });

g.call(chart);

function randomize() {
  g.data(randomBullets).call(chart);
}

function randomBullets() {
  return d3.range(n).map(function(i) {
    return {
      title: String.fromCharCode(65 + i),
      subtitle: "numbers",
      ranges: d3.range(3).map(randomNumber),
      markers: d3.range(1).map(randomNumber),
      measures: d3.range(1).map(randomNumber)
    };
  });
}

function randomNumber() {
  return Math.random() * 1000;
}

    </script>
  </body>
</html>
